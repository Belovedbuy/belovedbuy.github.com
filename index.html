<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="BelovedBuy - Discover the best tech deals and reviews.">
  <title>BelovedBuy - Best Tech Deals and Reviews</title>
  <link rel="stylesheet" href="style.css">
  <script type="module" src="firebase.js"></script>
</head>
<body>
  <header>
    <h1>BelovedBuy - Best Tech Deals</h1>
  </header>

  <main>
    <!-- Password Modal -->
    <section id="passwordModal" class="modal">
      <div class="modal-content">
        <h2>Enter Password</h2>
        <input type="password" id="passwordInput" placeholder="Enter password">
        <button onclick="checkPassword()">Submit</button>
      </div>
    </section>

    <!-- Add Product Form -->
    <section id="productForm" class="form hidden">
      <h2>Add/Edit Product</h2>
      <input type="text" id="productTitle" placeholder="Product Title">
      <textarea id="productDescription" placeholder="Description"></textarea>
      <input type="text" id="productImage" placeholder="Image URL">
      <input type="text" id="productPrice" placeholder="Price">
      <input type="text" id="productRating" placeholder="Rating">
      <textarea id="productContent" placeholder="Content/Blog"></textarea>
      <input type="text" id="productLink" placeholder="Amazon/Konga/Jumia Link">
      <button onclick="addProduct()">Save Product</button>
    </section>

    <!-- Product List -->
    <section id="productList" class="list">
      <!-- Dynamically rendered products -->
    </section>
  </main>

  <footer>
    <p>&copy; 2025 BelovedBuy. All rights reserved.</p>
  </footer>

  <script type="module">
    import { db } from "./firebase.js";
    import { collection, getDocs, addDoc, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js";

    let isAuthorized = false;

    function showPasswordModal() {
      document.getElementById('passwordModal').style.display = 'block';
    }

    function checkPassword() {
      const password = document.getElementById('passwordInput').value;
      if (password === '20071961Bc@') {
        isAuthorized = true;
        document.getElementById('passwordModal').style.display = 'none';
        document.getElementById('productForm').classList.remove('hidden');
      } else {
        alert('Incorrect password!');
      }
    }

    async function loadProducts() {
      const products = await getDocs(collection(db, "products"));
      const productList = document.getElementById("productList");
      productList.innerHTML = "";
      products.forEach((doc) => {
        const product = doc.data();
        const card = document.createElement("div");
        card.className = "product-card";
        card.innerHTML = `
          <h3>${product.title}</h3>
          <img src="${product.image}" alt="${product.title}">
          <p>${product.description}</p>
          <button onclick="editProduct('${doc.id}')">Edit</button>
          <button onclick="deleteProduct('${doc.id}')">Delete</button>
        `;
        productList.appendChild(card);
      });
    }

    async function addProduct() {
      if (!isAuthorized) return alert("Unauthorized");
      const title = document.getElementById("productTitle").value;
      const description = document.getElementById("productDescription").value;
      const image = document.getElementById("productImage").value;
      const price = document.getElementById("productPrice").value;
      const rating = document.getElementById("productRating").value;
      const content = document.getElementById("productContent").value;
      const link = document.getElementById("productLink").value;

      await addDoc(collection(db, "products"), { title, description, image, price, rating, content, link });
      loadProducts();
    }

    async function deleteProduct(id) {
      await deleteDoc(doc(db, "products", id));
      loadProducts();
    }

    async function editProduct(id) {
      const productRef = doc(db, "products", id);
      const title = prompt("Enter new title:");
      if (title) {
        await updateDoc(productRef, { title });
        loadProducts();
      }
    }

    document.addEventListener("DOMContentLoaded", loadProducts);
  </script>
</body>
</html>
